{% extends 'reports/pdf_base.html' %}

{% block title %}{{ category.title }} - ‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ{% endblock %}

{% block chapter_header %}{{ category.title }}{% endblock %}

{% block content %}
<!-- Cover Page -->
<div class="cover-page">
    <div class="cover-title">
        ‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ
    </div>
    <div class="cover-subtitle">
        {{ category.title }}
    </div>
    
    <div style="margin: 2cm 0;">
        {% if category.description %}
        <div style="font-size: 12pt; max-width: 80%; margin: 0 auto; text-align: justify;">
            {{ category.description }}
        </div>
        {% endif %}
    </div>
    
    <div class="cover-info">
        {% if publication_settings %}
        <div><strong>‡§™‡•ç‡§∞‡§ï‡§æ‡§∂‡§® ‡§Æ‡§ø‡§§‡§ø:</strong> {{ publication_settings.publication_date|date:"Y F j" }}</div>
        <div><strong>‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£:</strong> {{ publication_settings.version }}</div>
        {% endif %}
        
        <div style="margin-top: 2em; font-size: 10pt;">
            ¬© {% now "Y" %} ‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ‡•§ ‡§∏‡§¨‡•à ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§
        </div>
    </div>
</div>

<!-- Table of Contents for this Category -->
{% if category.sections.all %}
<div class="toc-page">
    <h1 class="toc-title">{{ category.title }} - ‡§∏‡•Ç‡§ö‡•Ä‡§™‡§§‡•ç‡§∞</h1>
    
    {% for section in category.sections.all %}
    <div class="toc-item level-1">
        <span>{{ section.order|default:forloop.counter }}. {{ section.title }}</span>
        <span class="page-number">{{ forloop.counter }}</span>
    </div>
    {% endfor %}
    
    <!-- List figures and tables if any -->
    {% if category_figures %}
    <div style="margin-top: 2em;">
        <h3>‡§ö‡§ø‡§§‡•ç‡§∞‡§π‡§∞‡•Ç</h3>
        {% for figure in category_figures %}
        <div class="list-item">
            <span class="title">‡§ö‡§ø‡§§‡•ç‡§∞ {{ figure.figure_number }}: {{ figure.title }}</span>
            <span class="page-number">{{ figure.page_number|default:forloop.counter }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if category_tables %}
    <div style="margin-top: 2em;">
        <h3>‡§§‡§æ‡§≤‡§ø‡§ï‡§æ‡§π‡§∞‡•Ç</h3>
        {% for table in category_tables %}
        <div class="list-item">
            <span class="title">‡§§‡§æ‡§≤‡§ø‡§ï‡§æ {{ table.table_number }}: {{ table.title }}</span>
            <span class="page-number">{{ table.page_number|default:forloop.counter }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Main Content -->
<div class="section-break">
    <h1>{{ category.title }}</h1>
    
    {% if category.description %}
    <div class="lead">{{ category.description }}</div>
    {% endif %}
    
    {% for section in category.sections.all %}
    <div class="{% if not forloop.first %}section-break{% endif %}">
        <h2>{{ section.order|default:forloop.counter }}. {{ section.title }}</h2>
        
        {% if section.description %}
        <p class="lead">{{ section.description }}</p>
        {% endif %}
        
        {% if section.content %}
        <div class="content-section">
            {{ section.content|safe }}
        </div>
        {% endif %}
        
        <!-- Section Figures -->
        {% for figure in section.figures.all %}
        <div class="figure-container">
            {% if figure.image %}
            <img src="{{ figure.image.url }}" alt="{{ figure.caption }}">
            {% endif %}
            <div class="figure-caption">
                <strong>‡§ö‡§ø‡§§‡•ç‡§∞ {{ figure.figure_number }}:</strong> {{ figure.title }}
                {% if figure.caption %}<br>{{ figure.caption }}{% endif %}
                {% if figure.source %}<br><em>‡§∏‡•ç‡§∞‡•ã‡§§: {{ figure.source }}</em>{% endif %}
            </div>
        </div>
        {% endfor %}
        
        <!-- Section Tables -->
        {% for table in section.tables.all %}
        <div class="table-container">
            <table>
                <caption>
                    <strong>‡§§‡§æ‡§≤‡§ø‡§ï‡§æ {{ table.table_number }}:</strong> {{ table.title }}
                    {% if table.caption %}<br>{{ table.caption }}{% endif %}
                </caption>
                {% if table.data %}
                <thead>
                    <tr>
                        {% for header in table.data.0 %}
                        <th>{{ header }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in table.data|slice:"1:" %}
                    <tr>
                        {% for cell in row %}
                        <td>{{ cell }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
                {% endif %}
            </table>
            {% if table.source %}
            <div class="small text-muted mt-1">‡§∏‡•ç‡§∞‡•ã‡§§: {{ table.source }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% empty %}
    <div class="no-break">
        <div style="text-align: center; padding: 3em 0; color: #666;">
            <div style="font-size: 48pt; margin-bottom: 0.5em;">üìÅ</div>
            <h3>‡§Ø‡§∏ ‡§µ‡§ø‡§∑‡§Ø‡§Æ‡§æ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§õ‡•à‡§®</h3>
            <p>‡§Ø‡§∏ ‡§µ‡§ø‡§∑‡§Ø‡§ï‡•ã ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§Ö‡§ù‡•à ‡§§‡§Ø‡§æ‡§∞ ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§õ‡•à‡§®‡•§</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Summary/Conclusion for Category -->
{% if category.sections.all %}
<div class="section-break">
    <h1>‡§®‡§ø‡§∑‡•ç‡§ï‡§∞‡•ç‡§∑</h1>
    
    <div class="important">
        <h3>‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§¨‡§ø‡§®‡•ç‡§¶‡•Å‡§π‡§∞‡•Ç:</h3>
        <ul>
            {% for section in category.sections.all %}
            <li>{{ section.title }} - {{ section.description|default:"‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§õ‡•§"|truncatewords:10 }}</li>
            {% endfor %}
        </ul>
    </div>
    
    <!-- Statistics Summary -->
    {% if category_figures or category_tables %}
    <div class="stats-grid mt-3">
        {% if category_figures %}
        <div class="stat-item">
            <span class="stat-value">{{ category_figures|length }}</span>
            <div class="stat-label">‡§ö‡§ø‡§§‡•ç‡§∞‡§π‡§∞‡•Ç</div>
        </div>
        {% endif %}
        {% if category_tables %}
        <div class="stat-item">
            <span class="stat-value">{{ category_tables|length }}</span>
            <div class="stat-label">‡§§‡§æ‡§≤‡§ø‡§ï‡§æ‡§π‡§∞‡•Ç</div>
        </div>
        {% endif %}
        <div class="stat-item">
            <span class="stat-value">{{ category.sections.all|length }}</span>
            <div class="stat-label">‡§â‡§™-‡§µ‡§ø‡§∑‡§Ø‡§π‡§∞‡•Ç</div>
        </div>
    </div>
    {% endif %}
    
    <div class="note mt-3">
        <p><strong>‡§®‡•ã‡§ü:</strong> ‡§Ø‡•ã ‡§µ‡§ø‡§∑‡§Ø‡§ï‡•ã ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ‡§ï‡•ã ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡§§‡§ø‡§µ‡•á‡§¶‡§®‡§Æ‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§õ‡•§ ‡§•‡§™ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä‡§ï‡§æ ‡§≤‡§æ‡§ó‡§ø ‡§∏‡§Æ‡•ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡§§‡§ø‡§µ‡•á‡§¶‡§® ‡§π‡•á‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</p>
    </div>
</div>
{% endif %}

<!-- Footer Information -->
<div class="page-footer">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2em; padding-top: 1em; border-top: 1px solid #ddd;">
        <div>
            <h4>‡§∏‡§Æ‡•ç‡§™‡§∞‡•ç‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h4>
            <p>
                <strong>‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ</strong><br>
                {% if publication_settings.contact_email %}
                ‡§á‡§Æ‡•á‡§≤: {{ publication_settings.contact_email }}<br>
                {% endif %}
                ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü: www.gadhawa.gov.np
            </p>
        </div>
        <div>
            <h4>‡§™‡•ç‡§∞‡§ï‡§æ‡§∂‡§® ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h4>
            <p>
                {% if publication_settings %}
                ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂‡§® ‡§Æ‡§ø‡§§‡§ø: {{ publication_settings.publication_date|date:"Y F j" }}<br>
                ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£: {{ publication_settings.version }}<br>
                {% endif %}
                ‡§µ‡§ø‡§∑‡§Ø: {{ category.title }}
            </p>
        </div>
    </div>
    
    <div class="text-center mt-2">
        {% if publication_settings.copyright_notice %}
        {{ publication_settings.copyright_notice }}
        {% else %}
        ¬© {% now "Y" %} ‡§ó‡§¢‡§µ‡§æ ‡§ó‡§æ‡§â‡§Å‡§™‡§æ‡§≤‡§ø‡§ï‡§æ‡•§ ‡§∏‡§¨‡•à ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§
        {% endif %}
    </div>
</div>

{% endblock %}
