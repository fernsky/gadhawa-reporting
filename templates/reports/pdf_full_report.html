{% extends 'reports/pdf_base.html' %}
{% load nepali_filters %}

{% block title %}गढवा गाउँपालिका - पूर्ण प्रतिवेदन{% endblock %}

{% block content %}
<!-- Cover Page -->
<div class="cover-page" style="position: relative; height: 100vh; overflow: hidden; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
    
    <!-- Decorative Background Elements -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;">
        <!-- Top geometric pattern -->
        <div style="position: absolute; top: -100px; right: -100px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(211,47,47,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <!-- Bottom left pattern -->
        <div style="position: absolute; bottom: -80px; left: -80px; width: 250px; height: 250px; background: radial-gradient(circle, rgba(25,118,210,0.08) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <!-- Subtle grid overlay -->
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(circle at 2px 2px, rgba(0,0,0,0.03) 1px, transparent 0); background-size: 40px 40px; opacity: 0.3;"></div>
    </div>
    
    <!-- Main Content Container -->
    <div style="position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column;">
        
        <!-- Header Section -->
        <div style="flex: 0 0 auto; padding: 2.5cm 2cm 1cm 2cm;">
            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.9); padding: 1.5rem 2rem; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); backdrop-filter: blur(10px);">
                
                <!-- Left Logo -->
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(211,47,47,0.3);">
                    <div style="color: white; font-size: 20pt; font-weight: 700;">ने</div>
                </div>
                
                <!-- Center Content -->
                <div style="flex: 1; text-align: center; margin: 0 2rem;">
                    <div style="color: #d32f2f; font-size: 20pt; font-weight: 700; margin-bottom: 0.3rem; letter-spacing: 1px;">
                        गढवा गाउँपालिका
                    </div>
                    <div style="color: #d32f2f; font-size: 14pt; font-weight: 500; margin-bottom: 0.3rem;">
                        गाउँकार्यपालिकाको कार्यालय
                    </div>
                    <div style="color: #666; font-size: 11pt; font-weight: 400;">
                        लुम्बिनी प्रदेश, नेपाल सरकार
                    </div>
                </div>
                
                <!-- Right Logo -->
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 16px rgba(25,118,210,0.3);">
                    <div style="color: white; font-size: 20pt; font-weight: 700;">ग</div>
                </div>
            </div>
        </div>
        
        <!-- Main Title Section -->
        <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0 2cm;">
            
            <!-- Secondary Info Card -->
            <div style="background: rgba(255,255,255,0.95); border: 2px solid #1976d2; border-radius: 15px; padding: 2rem 2.5rem; box-shadow: 0 8px 32px rgba(25,118,210,0.2); backdrop-filter: blur(10px); text-align: center; max-width: 70%;">
                <div style="color: #1976d2; font-size: 18pt; font-weight: 600; margin-bottom: 0.8rem; letter-spacing: 1px;">
                    डिजिटल प्रोफाइल र वार्षिक प्रतिवेदन
                </div>
                <div style="color: #555; font-size: 14pt; font-weight: 400;">
                    सम्पूर्ण प्रतिवेदन २०८१
                </div>
            </div>
        </div>
        
        <!-- Bottom Section -->
        <div style="flex: 0 0 auto; padding: 1cm 2cm 2.5cm 2cm; text-align: center;">
            
            <!-- Status Badge -->
            <div style="display: inline-block; background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: #fdd835; padding: 1.2rem 2.5rem; border-radius: 50px; box-shadow: 0 8px 24px rgba(211,47,47,0.4); margin-bottom: 1.5rem;">
                <div style="font-size: 14pt; font-weight: 600; margin-bottom: 0.2rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">मस्यौदा प्रतिवेदन</div>
                <div style="font-size: 18pt; font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">२०८१</div>
            </div>
            
            <!-- Decorative Divider -->
            <div style="width: 200px; height: 1px; background: linear-gradient(90deg, transparent 0%, #d32f2f 20%, #1976d2 50%, #d32f2f 80%, transparent 100%); margin: 1.5rem auto; position: relative;">
                <div style="position: absolute; top: -3px; left: 50%; transform: translateX(-50%); width: 8px; height: 8px; background: #1976d2; border-radius: 50%;"></div>
            </div>
            
            <!-- Publication Info -->
            {% if publication_settings %}
            <div style="font-size: 10pt; color: #666; line-height: 1.4;">
                <div style="margin-bottom: 0.3rem;">प्रकाशन मिति: {{ publication_settings.publication_date|nepali_date:"Y F j" }}</div>
                {% if publication_settings.version %}
                <div>संस्करण: {{ publication_settings.version }}</div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Table of Contents -->
<div class="toc-page">
    <h1 class="toc-title">सूचीपत्र</h1>
    
    <!-- Front Matter -->
    <div class="toc-item level-1">
        <span>सूचीपत्र</span>
        <span class="page-number">i</span>
    </div>
    {% if total_figures > 0 %}
    <div class="toc-item level-1">
        <span>चित्रहरूको सूची</span>
        <span class="page-number">ii</span>
    </div>
    {% endif %}
    {% if total_tables > 0 %}
    <div class="toc-item level-1">
        <span>तालिकाहरूको सूची</span>
        <span class="page-number">iii</span>
    </div>
    {% endif %}
    
    <div style="margin: 1.5em 0; border-bottom: 1px solid #ddd;"></div>
    
    <!-- Main Content -->
    {% for category in categories %}
    <div class="toc-item level-1">
        <span>{{ category.order|default:forloop.counter|nepali_digits }}. {{ category.name_nepali|default:category.name }}</span>
        <span class="page-number">{{ forloop.counter|nepali_digits }}</span>
    </div>
    {% for section in category.sections.all %}
    <div class="toc-item level-2">
        <span>{{ category.order|default:forloop.parentloop.counter|nepali_digits }}.{{ section.order|default:forloop.counter|nepali_digits }} {{ section.title_nepali|default:section.title }}</span>
        <span class="page-number">{{ forloop.parentloop.counter|nepali_digits }}.{{ forloop.counter|nepali_digits }}</span>
    </div>
    {% endfor %}
    {% endfor %}
</div>

<!-- List of Figures -->
{% if figures %}
<div class="list-page">
    <h1 class="list-title">चित्रहरूको सूची</h1>
    {% for figure in figures %}
    <div class="list-item">
        <span class="title">चित्र {{ figure.figure_number|nepali_digits }}: {{ figure.title_nepali|default:figure.title }}</span>
        <span class="page-number">{{ forloop.counter|nepali_digits }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- List of Tables -->
{% if tables %}
<div class="list-page">
    <h1 class="list-title">तालिकाहरूको सूची</h1>
    {% for table in tables %}
    <div class="list-item">
        <span class="title">तालिका {{ table.table_number|nepali_digits }}: {{ table.title_nepali|default:table.title }}</span>
        <span class="page-number">{{ forloop.counter|nepali_digits }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Main Content -->
{% for category in categories %}
<div class="section-break">
    <h1 class="category-title">{{ category.order|default:forloop.counter|nepali_digits }}. {{ category.name_nepali|default:category.name }}</h1>
    
    {% if category.description_nepali or category.description %}
    <div class="lead">{{ category.description_nepali|default:category.description }}</div>
    {% endif %}
    
    {% for section in category.sections.all %}
    <div class="{% if not forloop.first %}no-break{% endif %}" style="margin-top: 2em;">
        <h2>{{ category.order|default:forloop.parentloop.counter|nepali_digits }}.{{ section.order|default:forloop.counter|nepali_digits }} {{ section.title_nepali|default:section.title }}</h2>
        
        {% if section.summary_nepali or section.summary %}
        <p class="lead">{{ section.summary_nepali|default:section.summary }}</p>
        {% endif %}
        
        {% if section.content_nepali or section.content %}
        <div class="content-section">
            {{ section.content_nepali|default:section.content|safe }}
        </div>
        {% else %}
        <div class="note">
            <p>यस खण्डमा {{ section.title_nepali|default:section.title }} सम्बन्धी विस्तृत जानकारी समावेश गरिनेछ।</p>
            
            <!-- Add contextual sample content -->
            {% if 'demographic' in section.slug or 'जनसंख्या' in section.title_nepali %}
            <div class="table-container">
                <table>
                    <caption><strong>जनसंख्या विवरण (नमूना डेटा)</strong></caption>
                    <thead>
                        <tr>
                            <th>वडा नं.</th>
                            <th>पुरुष</th>
                            <th>महिला</th>
                            <th>कुल</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>१</td><td>१,२५०</td><td>१,१८०</td><td>२,४३०</td></tr>
                        <tr><td>२</td><td>१,१००</td><td>१,०५०</td><td>२,१५०</td></tr>
                        <tr><td>३</td><td>९८०</td><td>९४०</td><td>१,९२०</td></tr>
                        <tr style="font-weight: bold;"><td>कुल</td><td>३,३३०</td><td>३,१७०</td><td>६,५००</td></tr>
                    </tbody>
                </table>
            </div>
            {% elif 'economic' in section.slug or 'आर्थिक' in section.title_nepali %}
            <div class="table-container">
                <table>
                    <caption><strong>आर्थिक गतिविधि (नमूना डेटा)</strong></caption>
                    <thead>
                        <tr>
                            <th>गतिविधि</th>
                            <th>घरधुरी संख्या</th>
                            <th>प्रतिशत</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>कृषि</td><td>८५०</td><td>६५%</td></tr>
                        <tr><td>व्यापार</td><td>२००</td><td>१५%</td></tr>
                        <tr><td>सेवा</td><td>१५०</td><td>१२%</td></tr>
                        <tr><td>अन्य</td><td>१००</td><td>८%</td></tr>
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Section Figures -->
        {% for figure in section.figures.all %}
        <div class="figure-container">
            {% if figure.image %}
            <img src="{{ figure.image.url }}" alt="{{ figure.title_nepali|default:figure.title }}">
            {% endif %}
            <div class="figure-caption">
                <strong>चित्र {{ figure.figure_number|nepali_digits }}:</strong> {{ figure.title_nepali|default:figure.title }}
                {% if figure.description_nepali or figure.description %}
                <br>{{ figure.description_nepali|default:figure.description }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <!-- Section Tables -->
        {% for table in section.tables.all %}
        <div class="table-container">
            <table>
                <caption>
                    <strong>तालिका {{ table.table_number }}:</strong> {{ table.title_nepali|default:table.title }}
                </caption>
                {% if table.data %}
                {{ table.data|safe }}
                {% else %}
                <thead>
                    <tr>
                        <th>विवरण</th>
                        <th>संख्या</th>
                        <th>प्रतिशत</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="3" style="text-align: center; color: #666; font-style: italic;">
                            डेटा उपलब्ध छैन
                        </td>
                    </tr>
                </tbody>
                {% endif %}
            </table>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endfor %}

<!-- Back Cover / Additional Information -->
<div class="section-break">
    <h1>अतिरिक्त जानकारी</h1>
    
    <div class="no-break">
        <h2>गढवा गाउँपालिकाको सम्पर्क विवरण</h2>
        <div class="important">
            <p><strong>कार्यपालिकाको कार्यालय:</strong><br>
            गढवा गाउँपालिका<br>
            बाँके, लुम्बिनी प्रदेश, नेपाल</p>
            
            <p><strong>फोन:</strong> ०८१-४०००००<br>
            <strong>इमेल:</strong> info@gadhawa.gov.np<br>
            <strong>वेबसाइट:</strong> www.gadhawa.gov.np</p>
        </div>
    </div>
    
    {% if publication_settings %}
    <div class="no-break mt-3">
        <h2>प्रकाशन सम्बन्धी जानकारी</h2>
        <div class="note">
            <p><strong>प्रकाशक:</strong> गढवा गाउँपालिका<br>
            <strong>प्रकाशन मिति:</strong> {{ publication_settings.publication_date|date:"Y F j" }}<br>
            <strong>संस्करण:</strong> {{ publication_settings.version }}</p>
            
            {% if publication_settings.isbn %}
            <p><strong>ISBN:</strong> {{ publication_settings.isbn }}</p>
            {% endif %}
            
            {% if publication_settings.editor_name %}
            <p><strong>सम्पादक:</strong> {{ publication_settings.editor_name }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <div class="no-break mt-3">
        <h2>कानुनी सूचना</h2>
        <div class="warning">
            <p>यस प्रतिवेदनमा उल्लेखित सबै तथ्यांक र जानकारीहरू सम्बन्धित निकायबाट प्राप्त भएका हुन्। डेटाको शुद्धताका लागि गढवा गाउँपालिका जिम्मेवार छ।</p>
            
            <p>यस प्रतिवेदनको कुनै पनि भाग गढवा गाउँपालिकाको लिखित अनुमति बिना पुनः प्रकाशन गर्न मिल्दैन।</p>
        </div>
    </div>
    
    <div class="page-footer mt-3">
        <div class="text-center">
            <p style="font-size: 12pt; font-weight: bold;">
                गढवा गाउँपालिका<br>
                "समृद्ध गढवा, सुखी नागरिक"
            </p>
            <p style="font-size: 10pt; color: #666;">
                यो प्रतिवेदन {{ generated_date|date:"Y F j" }} मा तयार गरिएको हो।
            </p>
        </div>
    </div>
</div>

{% endblock %}
