{% extends 'reports/pdf_base.html' %}
{% load nepali_filters %}

{% block title %}गढवा गाउँपालिका - पूर्ण प्रतिवेदन{% endblock %}

{% block content %}
<!-- Cover Page -->
<div class="cover-page">
    <div style="text-align: center; margin-bottom: 4cm;">            
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2cm;">
            <div style="width: 80px; height: 80px;">
                <!-- Nepal Government Logo placeholder -->
            </div>
            <div style="flex-grow: 1;">
                <div style="color: #1e3a8a; font-size: 20pt; font-weight: 700; margin-bottom: 0.5em;">
                    गढवा गाउँपालिका
                </div>
                <div style="color: #1e40af; font-size: 16pt; font-weight: 600; margin-bottom: 0.5em;">
                    गाउँकार्यपालिकाको कार्यालय
                </div>
                <div style="color: #1e40af; font-size: 12pt; margin-bottom: 0.5em;">
                    लुम्बिनी प्रदेश, नेपाल सरकार
                </div>
            </div>
            <div style="width: 80px; height: 80px;">
                <!-- Municipality Logo placeholder -->
            </div>
        </div>
        
        <!-- Main Title Section -->
        <div style="color: #dc2626; padding: 1.5em; margin: 2cm 0; font-size: 24pt; font-weight: 700;">
            गाउँपालिका पार्श्वचित्र
        </div>

        <!-- Bottom Section -->
        <div style="color: #0f172a; padding: 1em; margin-top: 1cm;">
            <div style="font-size: 16pt; font-weight: 600;">मस्यौदा प्रतिवेदन</div>
            <div style="font-size: 18pt; font-weight: 700;">२०८१</div>
        </div>
    </div>
    
    <!-- Publication Info -->
    {% if publication_settings %}
    <div style="position: absolute; bottom: 2cm; left: 50%; transform: translateX(-50%); text-align: center; font-size: 10pt; color: #64748b;">
        <div>प्रकाशन मिति: {{ publication_settings.publication_date|nepali_date:"Y F j" }}</div>
        {% if publication_settings.version %}
        <div>संस्करण: {{ publication_settings.version }}</div>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Table of Contents -->
<div class="toc-page">
    <h1 class="toc-title" style="color: #1e3a8a; border-bottom: 3px solid #0ea5e9;">विषयसूची</h1>
    
    <!-- Categories and Sections -->
    {% for category in categories %}
    <div class="toc-item level-1">
        <span class="toc-link">{{ category.category_number|nepali_digits }}. {{ category.name_nepali|default:category.name }}</span>
        <span class="page-ref" data-target="#category-{{ category.id }}"></span>
    </div>
    
    {% for section in category.sections.all %}
    {% with section_parts=section.section_number|split:"." %}
    {% if section_parts|length == 2 %}
    <div class="toc-item level-2">
        <span class="toc-link">{{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}</span>
        <span class="page-ref" data-target="#section-{{ section.id }}"></span>
    </div>
    {% elif section_parts|length == 3 %}
    <div class="toc-item level-3">
        <span class="toc-link">{{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}</span>
        <span class="page-ref" data-target="#section-{{ section.id }}"></span>
    </div>
    {% elif section_parts|length == 4 %}
    <div class="toc-item level-4">
        <span class="toc-link">{{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}</span>
        <span class="page-ref" data-target="#section-{{ section.id }}"></span>
    </div>
    {% else %}
    <div class="toc-item level-2">
        <span class="toc-link">{{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}</span>
        <span class="page-ref" data-target="#section-{{ section.id }}"></span>
    </div>
    {% endif %}
    {% endwith %}
    {% endfor %}
    {% endfor %}
</div>

<!-- List of Figures -->
{% if figures %}
<div class="list-page">
    <h1 class="list-title" style="color: #1e3a8a; border-bottom: 3px solid #0ea5e9;">चित्रहरूको सूची</h1>
    {% for figure in figures %}
    <div class="list-item">
        <a href="#figure-{{ figure.id }}" class="title">चित्र {{ figure.figure_number|nepali_digits }}: {{ figure.title_nepali|default:figure.title }}</a>
        <span class="page-ref" data-target="figure-{{ figure.id }}"></span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- List of Tables -->
{% if tables %}
<div class="list-page">
    <h1 class="list-title" style="color: #1e3a8a; border-bottom: 3px solid #0ea5e9;">तालिकाहरूको सूची</h1>
    {% for table in tables %}
    <div class="list-item">
        <a href="#table-{{ table.id }}" class="title">तालिका {{ table.table_number|nepali_digits }}: {{ table.title_nepali|default:table.title }}</a>
        <span class="page-ref" data-target="table-{{ table.id }}"></span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Main Content Start -->
<div class="main-content-start">
{% for category in categories %}
<div class="section-break" id="category-{{ category.id }}">
    <h1 class="category-title" style="color: #dc2626; text-align: center; padding: 0.5em;">
        परिच्छेद – {{ category.category_number|nepali_digits }}ः {{ category.name_nepali|default:category.name }}
    </h1>
    
    {% for section in category.sections.all %}
    {% with section_parts=section.section_number|split:"." %}
    <div class="section-content" id="section-{{ section.id }}">
        
        <!-- Section Header with proper hierarchy -->
        {% if section_parts|length == 2 %}
        <h2 class="section-header level-2" style="color: #1e40af; border-bottom: 2px solid #0ea5e9; padding-bottom: 0.3em; font-size: 16pt; margin-top: 2em;">
            {{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}
        </h2>
        {% elif section_parts|length == 3 %}
        <h3 class="section-header level-3" style="color: #2563eb; border-bottom: 1px solid #60a5fa; padding-bottom: 0.2em; font-size: 14pt; margin-left: 1em; margin-top: 1.5em;">
            {{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}
        </h3>
        {% elif section_parts|length == 4 %}
        <h4 class="section-header level-4" style="color: #3b82f6; font-size: 13pt; margin-left: 2em; margin-top: 1em;">
            {{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}
        </h4>
        {% else %}
        <h2 class="section-header level-2" style="color: #1e40af; border-bottom: 2px solid #0ea5e9; padding-bottom: 0.3em; margin-top: 2em;">
            {{ section.section_number|nepali_section_number }} {{ section.title_nepali|default:section.title }}
        </h2>
        {% endif %}
        
        <!-- Section Content -->
        {% if section.content_nepali or section.content %}
        <div class="content-section" style="margin-left: {% if section_parts|length == 3 %}1em{% elif section_parts|length == 4 %}2em{% else %}0{% endif %};">
            {{ section.content_nepali|default:section.content|safe }}
        </div>
        {% endif %}
        
        <!-- Section Figures -->
        {% for figure in section.figures.all %}
        <div class="figure-container" id="figure-{{ figure.id }}" style="margin: 1.5em 0; margin-left: {% if section_parts|length == 3 %}1em{% elif section_parts|length == 4 %}2em{% else %}0{% endif %};">
            {% if figure.image %}
            <div class="figure-image" style="text-align: center; margin-bottom: 0.5em;">
                <img src="{{ figure.image.url }}" alt="{{ figure.title_nepali|default:figure.title }}" style="max-width: 100%; height: auto; border: 1px solid #e5e7eb;">
            </div>
            {% endif %}
            <div class="figure-caption" style="font-size: 10pt; color: #4b5563; text-align: center; font-style: italic;">
                <strong>चित्र {{ figure.figure_number|nepali_digits }}:</strong> {{ figure.title_nepali|default:figure.title }}
                {% if figure.description_nepali or figure.description %}
                <br>{{ figure.description_nepali|default:figure.description }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <!-- Section Tables -->
        {% for table in section.tables.all %}
        <div class="table-container" id="table-{{ table.id }}" style="margin: 1.5em 0; margin-left: {% if section_parts|length == 3 %}1em{% elif section_parts|length == 4 %}2em{% else %}0{% endif %};">
            <table class="data-table" style="width: 100%; border-collapse: collapse; margin: 1em 0; font-size: 11pt;">
                <caption style="font-size: 10pt; color: #4b5563; margin-bottom: 0.5em; font-weight: bold;">
                    <strong>तालिका {{ table.table_number|nepali_digits }}:</strong> {{ table.title_nepali|default:table.title }}
                </caption>
                {% if table.data %}
                <thead>
                    {% if table.data.0 %}
                    <tr style="background-color: #f3f4f6;">
                        {% for header in table.data.0 %}
                        <th style="border: 1px solid #d1d5db; padding: 0.5em; text-align: left; font-weight: 600;">
                            {{ header|nepali_digits }}
                        </th>
                        {% endfor %}
                    </tr>
                    {% endif %}
                </thead>
                <tbody>
                    {% for row in table.data %}
                    {% if not forloop.first %}
                    <tr>
                        {% for cell in row %}
                        <td style="border: 1px solid #d1d5db; padding: 0.5em;">
                            {{ cell|nepali_digits }}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
                {% endif %}
            </table>
            {% if table.description_nepali or table.description %}
            <div class="table-description" style="font-size: 10pt; color: #6b7280; margin-top: 0.5em; font-style: italic;">
                {{ table.description_nepali|default:table.description }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endwith %}
    {% endfor %}
</div>
{% endfor %}
</div>

{% endblock %}
